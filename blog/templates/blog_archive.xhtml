{% extends "base.xhtml" %}
{% load pytils_numeral %}

{% block custom_css %}
{% endblock %}

{% block title %}
Архив блога на Sphinx.net.ru
{% endblock %}

{% block navigation %}
<div id="nagivation">
  <a href="/">Sphinx.net.ru</a> / <a href="/blog/">блог</a> / 
  {% if month %}
    <a href="/blog/archive/">архив</a> /
    <a href="/blog/archive/{{ month|date:"Y" }}/">{{ month|date:"Y"}} год</a> /
    {{ month|date:"F" }} /
  {% else %}
    {% if year %}
      <a href="/blog/archive/">архив</a> /
      {{ year }} год /
    {% else %}
      {% if  archive_selection %}
        архив /
      {% else %}
        <a href="/blog/archive/">архив</a> / список всех записей /
      {% endif %}
    {% endif %}
  {% endif %}
</div>
{% endblock %}

{% block base %}
<div class="box">

  {% if month %}
    <h1>Все записи за {{ month|date:"F Y" }} года</h1>
  {% else %}
    {% if year %}
      <h1>Все записи за {{ year }} год</h1>
    {% else %}
      {% if archive_selection %}
        <h1>Архивы блога</h1>
      {% else %}
        <h1>Все записи блога</h1>
      {% endif %}
    {% endif %}
  {% endif %}
  
  {% for entry in entry_list %}
  {% if not entry.private or user.is_superuser %}

    {% if archive_selection %}
      {% ifchanged entry.add_date.year %}
      {% if not forloop.first %}</div>{% endif %}
      <div style="float: left; margin-right: 1em;">
        <h2>
          <a href="/blog/archive/{{ entry.add_date.year }}/"
             title="Все записи за {{ entry.add_date.year }} год">
            {{ entry.add_date|date:"Y" }}
          </a>
        </h2>
      {% endifchanged %}

      {% ifchanged entry.add_date.month %}
        <h3>
          <a href="/blog/archive/{{ entry.add_date|date:"Y/m" }}/"
            title="Все записи за {{ entry.add_date|date:"F Y" }}">
            {{ entry.add_date|date:"F" }}
          </a>
        </h3>
      {% endifchanged %}

    {% else %}

      {% if not month or year %}
        {% ifchanged entry.add_date.month %}
        <h2>
          {% if year %}
            <a href="/blog/archive/{{ year }}/{{ entry.add_date|date:"m"}}/">
              {{ entry.add_date|date:"F" }}
            </a>
          {% else %}
            <a href="/blog/archive/{{ entry.add_date.year }}/{{ entry.add_date.month }}/">{{ entry.add_date|date:"F" }}<a/>
            <a href="/blog/archive/{{ entry.add_date.year }}/">{{ entry.add_date.year }}</a>
          {% endif %}
        </h2>
        {% endifchanged %}

      {% endif %}
      
    {% if not month or year %}<h3 class="entry_title">{% else %}<h2 class="entry_title">{% endif %}
      <a href="{{ entry.get_absolute_url }}">{{ entry.title }}</a>
      {% if entry.comments %}({{ entry.comments }} комментари{{ entry.comments|choose_plural:"й,я,ев" }}){% endif %}
    {% if not month or year %}</h3>{% else %}</h2>{% endif %}
    
    {% endif %}
  {% endif %}

  {% if forloop.last %}
    {% if archive_selection %}
      </div>
      <p style="clear: both;">Можно посмотреть заголовки всех записей <a href="/blog/entry/" rel="appendix">одним списком</a> (всего {{ forloop.counter }}).</p>
    {% else %}
      <p>За выбранный период было написано {{ forloop.counter }} запис{{ forloop.counter|choose_plural:"ь,и,ей" }}.</p>
    {% endif %}
  {% endif %}

  {% endfor %}

</div>
{% endblock %}